(function(e,t){"use strict";function r(e,t){var r,i=[];for(var s=0;s<e.length;++s){r=n[e[s]]||o(e[s]);if(!r){throw"module definition dependecy not found: "+e[s]}i.push(r)}t.apply(null,i)}function i(e,i,s){if(typeof e!=="string"){throw"invalid module definition, module id must be defined and be a string"}if(i===t){throw"invalid module definition, dependencies must be specified"}if(s===t){throw"invalid module definition, definition function must be specified"}r(i,function(){n[e]=s.apply(null,arguments)})}function s(e){return!!n[e]}function o(t){var n=e;var r=t.split(/[.\/]/);for(var i=0;i<r.length;++i){if(!n[r[i]]){return}n=n[r[i]]}return n}function u(r){for(var i=0;i<r.length;i++){var s=e;var o=r[i];var u=o.split(/[.\/]/);for(var a=0;a<u.length-1;++a){if(s[u[a]]===t){s[u[a]]={}}s=s[u[a]]}s[u[u.length-1]]=n[o]}}var n={};var a="moxman/util/Loader",f="moxman/Env",l="moxman/util/I18n",c="moxman/Loader",h="moxman/interop/TinyMcePlugin";i(a,[],function(){"use strict";function n(){}function r(e){document.getElementsByTagName("head")[0].appendChild(e)}var e=0,t={};var i={maxLoadTime:5,load:function(e,t,n){function o(){if(s.length){i.loadScript(s.shift(),o,n)}else{u()}}function u(){if(r.length){i.loadCss(r.shift(),u,n)}else{t()}}var r=e.css||[],s=e.js||[];o()},loadScript:function(e,i,s){function a(){t[e]=true;i()}var o,u;if(t[e]){i();return}i=i||n;s=s||n;u=document.createElement("script");u.type="text/javascript";if(typeof e=="object"){for(o in e){u.setAttribute(o,e[o])}}else{u.src=e}if("onload"in u){u.onload=a;u.onerror=s}else{u.onreadystatechange=function(){var e=u.readyState;if(e=="complete"||e=="loaded"){a()}};u.onerror=s}r(u)},loadCss:function(s,o,u){function h(){t[s]=true;o()}function p(){var e=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(e&&e[1]<536)}function d(){var e=a.styleSheets,t,n=e.length,r;while(n--){t=e[n];r=t.ownerNode?t.ownerNode:t.owningElement;if(r&&r.id===f.id){h();return}}if((new Date).getTime()-c<i.maxLoadTime*1e3){window.setTimeout(d,0)}else{u()}}function v(){try{var e=l.sheet.cssRules;h();return e}catch(t){}if((new Date).getTime()-c<i.maxLoadTime*1e3){window.setTimeout(v,0)}else{u()}}var a=document,f,l,c;if(t[s]){o();return}o=o||n;u=u||n;f=a.createElement("link");f.rel="stylesheet";f.type="text/css";f.href=s;f.id="u"+e++;c=(new Date).getTime();if("onload"in f&&!p()){f.onload=h;f.onerror=u}else{if(navigator.userAgent.indexOf("Firefox")>0){l=a.createElement("style");l.textContent='@import "'+s+'"';v();r(l);return}else{d()}}r(f)}};return i});i(f,[],function(){return{ie7:document.all&&!window.opera&&!document.documentMode}});i(l,[],function(){"use strict";function e(e){var t=window;var n=e.split(/\//);for(var r=0;r<n.length;++r){if(!t[n[r]]){return}t=t[n[r]]}return t}var t=e("moxman/util/I18n");if(t){return t}var n={};return{add:function(e,t){for(var r in t){n[r]=t[r]}},translate:function(e){if(typeof e=="undefined"){return e}if(typeof e!="string"&&e.raw){return e.raw}if(e.push){var t=e.slice(1);e=(n[e[0]]||e[0]).replace(/\{([^\}]+)\}/g,function(e,n){return t[n]})}return n[e]||e},data:n}});i(c,[a,f,l],function(e,t,n){function i(r){return function(i){function a(){moxman.Env.baseUrl=t.baseUrl;moxman.util.JsonRpc.url=getMoxieManagerApiPage();moxman.ui.Control.translate=n.translate;moxman.ui.FloatPanel.zIndex=i.zIndex||moxman.ui.FloatPanel.zIndex;var e=new moxman.Manager(i);e.init(new moxman.views[r](e))}i=i||{};if(!t.baseUrl){var s=document.getElementsByTagName("script");for(var o=0;o<s.length;o++){var u=s[o].src;if(/(^|\/)moxman\./.test(u)){t.baseUrl=u.substring(0,u.lastIndexOf("/"))+"/..";break}}}if(!moxman.ui){e.load({js:[t.baseUrl+"/js/moxman.api.min.js",getMoxieManagerApiPage()+"?act=language"+(i.language?"&code="+i.language:""),getMoxieManagerApiPage()+"?act=PluginJs"],css:[t.baseUrl+"/skins/lightgray/skin"+(t.ie7?".ie7":"")+".min.css"]},a)}else{a()}}}var r=this||window;var s={browse:i("FileListView"),upload:i("UploadView"),edit:i("EditView"),zip:i("ZipView"),createDir:i("CreateDirView"),createDoc:i("CreateDocView"),view:i("GalleryView"),rename:i("RenameView")};r.moxman=r.moxman||{};for(var o in s){r.moxman[o]=s[o]}r.moxman.addI18n=n.add;return s});i(h,[c,f],function(e,t){tinymce.PluginManager.add("moxiemanager",function(n,r){function i(e,t,n){function r(e,t){var n,r;for(n=0,r=e,t=t.split(".");n<t.length;n++){r=r[t[n]]}return r}if(typeof e!="string"){return e(t,n)}e=""+e.replace(/\{\$([^\}]+)\}/g,function(e,i){var s,o=i.split("|"),u=r(t,o[0]);if(typeof u=="undefined"){return""}if(o.length==1&&n&&n.xmlEncode){u=n.xmlEncode(u)}for(s=1;s<o.length;s++){u=n[o[s]](u,t,i)}return u});e=e.replace(/\{\=([\w]+)([^\}]+)\}/g,function(e,i,s){return r(n,i)(t,i,s)});return e}t.baseUrl=r;n.settings.file_browser_callback=function(t,r,i,s){var o={};tinymce.each(n.settings,function(e,t){if(t.indexOf("moxiemanager_")===0){o[t.substring(13)]=e}});var u=n.windowManager.zIndex;if(tinymce.ui.FloatPanel){u=tinymce.ui.FloatPanel.currentZIndex}e.browse(tinymce.extend(o,{zIndex:u,url:n.documentBaseURI.toAbsolute(r),document_base_url:n.settings.document_base_url,view:i=="image"||i=="media"?"thumbs":"files",multiple:false,oninsert:function(e){var r=s.document.getElementById(t);r.value=n.convertURL(e.focusedFile.meta.url,null,true);if("fireEvent"in r){r.fireEvent("onchange")}else{var i=document.createEvent("HTMLEvents");i.initEvent("change",false,true);r.dispatchEvent(i)}}}))};n.addCommand("mceInsertFile",function(t,r){function a(e,t){return i(e,t,{urlencode:function(e){return encodeURIComponent(e)},xmlEncode:function(e){return tinymce.DOM.encode(e)},sizeSuffix:function(e){if(e==-1){return""}if(e>1048576){return Math.round(e/1048576,1)+" MB"}if(e>1024){return Math.round(e/1024,1)+" KB"}return e+" b"}})}var s={},o=n.selection,u;u=o.getRng();tinymce.each(n.settings,function(e,t){if(t.indexOf("moxiemanager_")===0){s[t.substring(13)]=e}});var f=n.windowManager.zIndex;if(tinymce.ui.FloatPanel){f=tinymce.ui.FloatPanel.currentZIndex}e.browse(tinymce.extend(s,{zIndex:f,view:n.getParam("moxiemanager_default_view","files"),document_base_url:n.settings.document_base_url,oninsert:function(e){var t="";tinymce.each(e.files,function(e,r){var i=/\.(gif|jpe?g|png)$/i.test(e.name);o.setRng(u);if(!i&&!o.isCollapsed()){n.execCommand("mceInsertLink",e.meta.url);return false}if(r>0){t+=" "}if(i){t+=a(n.getParam("moxiemanager_image_template",'<img src="{$meta.url}" '+'width="{$meta.width}" height="{$meta.height}">'),e)}else{t+=a(n.getParam("moxiemanager_file_template",'<a href="{$url}">{$name}</a>'),e)}});o.setRng(u);n.execCommand("mceInsertContent",false,t)}},r))});if(tinymce.Env){n.addButton("insertfile",{icon:"browse",title:"Insert file",cmd:"mceInsertFile"})}else{n.addButton("insertfile",{image:r+"/skins/lightgray/img/insertfile.gif",title:n.getLang("moxiemanager_insert","Insert file"),cmd:"mceInsertFile"})}});var n=tinymce.settings?tinymce.settings.language:"auto";if(n&&n!="en"){tinymce.ScriptLoader.load(getMoxieManagerApiPage()+"?act=language&tinymce=true&code="+n)}});u([a,f,l,c,h])})(this)