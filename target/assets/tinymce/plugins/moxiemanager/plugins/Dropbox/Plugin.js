moxman.require(["moxman/PluginManager","moxman/util/Path","moxman/util/Loader","moxman/util/JsonRpc"],function(e,t,n,r){e.add("dropbox",function(e){function i(){r.exec("dropbox.getClientId",{},function(i){n.loadScript({src:"//www.dropbox.com/static/api/1/dropbox.js",id:"dropboxjs","data-app-key":i},function(){Dropbox.choose({linkType:"direct",success:function(n){var i=t.join(e.currentDir.path,n[0].name);e.showThrobber();r.exec("importFromUrl",{url:n[0].link,path:i},function(){e.refresh(function(){e.selectByPath(i);e.hideThrobber()})})}})})})}e.addMenuItem({text:"Dropbox",icon:"dropbox",onclick:i,contexts:["upload"]})})})