(function(e,t){"use strict";e.formUtils.addValidator({name:"spamcheck",validatorFunction:function(e,t,n){var r=t.valAttr("captcha");return r===e},errorMessage:"",errorMessageKey:"badSecurityAnswer"});e.formUtils.addValidator({name:"confirmation",validatorFunction:function(e,t,n,r,i){var s="",o=t.valAttr("confirm")||t.attr("name")+"_confirmation",u=i.find('input[name="'+o+'"]').eq(0);if(u){s=u.val()}else{console.warn('Could not find an input with name "'+o+'"')}return e===s},errorMessage:"",errorMessageKey:"notConfirmed"});e.formUtils.addValidator({name:"creditcard",validatorFunction:function(t,n,r,i,s){var o={amex:[15,15],diners_club:[14,14],cjb:[16,16],laser:[16,19],visa:[16,16],mastercard:[16,16],maestro:[12,19],discover:[16,16]},u=e.split(n.valAttr("allowing")||"");if(u.length>0){var a=false;e.each(u,function(e,n){if(n in o){if(t.length>=o[n][0]&&t.length<=o[n][1]){a=true;return false}}else{console.warn('Use of unknown credit card "'+n+'"')}});if(!a)return false}if(t.replace(new RegExp("[0-9]","g"),"")!==""){return false}var f=0;e.each(t.split("").reverse(),function(e,t){t=parseInt(t,10);if(e%2===0){f+=t}else{t*=2;if(t<10){f+=t}else{f+=t-9}}});return f%10===0},errorMessage:"",errorMessageKey:"badCreditCard"});e.formUtils.addValidator({name:"cvv",validatorFunction:function(e){return e.replace(/[0-9]/g,"")===""&&(e+"").length==3},errorMessage:"",errorMessageKey:"badCVV"});e.formUtils.addValidator({name:"strength",validatorFunction:function(t,n,r){var i=n.valAttr("strength");if(i&&i>3)i=3;return e.formUtils.validators.validate_strength.calculatePasswordStrength(t)>=i},errorMessage:"",errorMessageKey:"badStrength",calculatePasswordStrength:function(e){if(e.length<4){return 0}var t=0;var n=function(e,t){var n="";for(var r=0;r<t.length;r++){var i=true;for(var s=0;s<e&&s+r+e<t.length;s++){i=i&&t.charAt(s+r)==t.charAt(s+r+e)}if(s<e){i=false}if(i){r+=e-1;i=false}else{n+=t.charAt(r)}}return n};t+=e.length*4;t+=(n(1,e).length-e.length)*1;t+=(n(2,e).length-e.length)*1;t+=(n(3,e).length-e.length)*1;t+=(n(4,e).length-e.length)*1;if(e.match(/(.*[0-9].*[0-9].*[0-9])/)){t+=5}if(e.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)){t+=5}if(e.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){t+=10}if(e.match(/([a-zA-Z])/)&&e.match(/([0-9])/)){t+=15}if(e.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&e.match(/([0-9])/)){t+=15}if(e.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&e.match(/([a-zA-Z])/)){t+=15}if(e.match(/^\w+$/)||e.match(/^\d+$/)){t-=10}if(t<0){t=0}if(t>100){t=100}if(t<20){return 0}else if(t<40){return 1}else if(t<=60){return 2}else{return 3}},strengthDisplay:function(t,n){var r={fontSize:"12pt",padding:"4px",bad:"Very bad",weak:"Weak",good:"Good",strong:"Strong"};if(n){e.extend(r,n)}t.bind("keyup",function(){var t=e(this).val();var n=typeof r.parent=="undefined"?e(this).parent():e(r.parent);var i=n.find(".strength-meter");if(i.length==0){i=e("<span></span>");i.addClass("strength-meter").appendTo(n)}if(!t){i.hide()}else{i.show()}var s=e.formUtils.validators.validate_strength.calculatePasswordStrength(t);var o={background:"pink",color:"#FF0000",fontWeight:"bold",border:"red solid 1px",borderWidth:"0px 0px 4px",display:"inline-block",fontSize:r.fontSize,padding:r.padding};var u=r.bad;if(s==1){u=r.weak}else if(s==2){o.background="lightyellow";o.borderColor="yellow";o.color="goldenrod";u=r.good}else if(s>=3){o.background="lightgreen";o.borderColor="darkgreen";o.color="darkgreen";u=r.strong}i.css(o).text(u)})}});var n=function(n,r,i,s,o){e.ajax({url:n,type:"POST",cache:false,data:r.attr("name")+"="+i,dataType:"json",error:function(e){alert("Server validation failed due to: "+e.statusText);if(t.JSON&&t.JSON.stringify){alert(t.JSON.stringify(e))}},success:function(t){if(t.valid){r.valAttr("backend-valid","true")}else{r.valAttr("backend-invalid","true");if(t.message)r.attr(s.validationErrorMsgAttribute,t.message);else r.removeAttr(s.validationErrorMsgAttribute)}if(!r.valAttr("has-keyup-event")){r.valAttr("has-keyup-event","1").bind("keyup",function(t){if(t.keyCode!=9&&t.keyCode!=16){e(this).valAttr("backend-valid",false).valAttr("backend-invalid",false).removeAttr(s.validationErrorMsgAttribute)}})}o()}})},r=function(){return false};e.formUtils.addValidator({name:"server",validatorFunction:function(t,i,s,o,u){var a=i.valAttr("backend-valid"),f=i.valAttr("backend-invalid"),l=document.location.href;if(i.valAttr("url")){l=i.valAttr("url")}else if("serverURL"in s){l=s.backendUrl}if(a)return true;else if(f)return false;if(e.formUtils.isValidatingEntireForm){u.bind("submit",r).addClass("validating-server-side").addClass("on-blur");i.addClass("validating-server-side");n(l,i,t,s,function(){u.removeClass("validating-server-side").removeClass("on-blur").get(0).onsubmit=function(){};u.unbind("submit",r);i.removeClass("validating-server-side");u.trigger("submit")});e.formUtils.haltValidation=true;return false}else{u.addClass("validating-server-side");i.addClass("validating-server-side");n(l,i,t,s,function(){u.removeClass("validating-server-side");i.removeClass("validating-server-side");i.trigger("blur")});return true}},errorMessage:"",errorMessageKey:"badBackend",validateOnKeyUp:false});e.fn.displayPasswordStrength=function(t){new e.formUtils.validators.validate_strength.strengthDisplay(this,t);return this}})(jQuery,window)