!function(){function e(e){return document.createElementNS(f,e)}function t(e){return(10>e?"0":"")+e}function n(e){var t=++g+"";return e?e+t:t}function r(r,u){function f(e,t){var n=h.offset(),r=/^touch/.test(e.type),i=n.left+y,o=n.top+y,f=(r?e.originalEvent.touches[0]:e).pageX-i,c=(r?e.originalEvent.touches[0]:e).pageY-o,p=Math.sqrt(f*f+c*c),m=!1;if(!t||!(b-E>p||p>b+E)){e.preventDefault();var g=setTimeout(function(){s.addClass("clockpicker-moving")},200);l&&h.append(_.canvas),_.setHand(f,c,!t,!0),a.off(d).on(d,function(e){e.preventDefault();var t=/^touch/.test(e.type),n=(t?e.originalEvent.touches[0]:e).pageX-i,r=(t?e.originalEvent.touches[0]:e).pageY-o;(m||n!==f||r!==c)&&(m=!0,_.setHand(n,r,!1,!0))}),a.off(v).on(v,function(e){a.off(v),e.preventDefault();var n=/^touch/.test(e.type),r=(n?e.originalEvent.changedTouches[0]:e).pageX-i,l=(n?e.originalEvent.changedTouches[0]:e).pageY-o;(t||m)&&r===f&&l===c&&_.setHand(r,l),"hours"===_.currentView?_.toggleView("minutes",x/2):u.autoclose&&(_.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){_.done()},x/2)),h.prepend(q),clearTimeout(g),s.removeClass("clockpicker-moving"),a.off(d)})}}var c=o(T),h=c.find(".clockpicker-plate"),m=c.find(".clockpicker-hours"),g=c.find(".clockpicker-minutes"),N=c.find(".clockpicker-am-pm-block"),C="INPUT"===r.prop("tagName"),L=C?r:r.find("input"),O=r.find(".input-group-addon"),_=this;if(this.id=n("cp"),this.element=r,this.options=u,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=C,this.input=L,this.addon=O,this.popover=c,this.plate=h,this.hoursView=m,this.minutesView=g,this.amPmBlock=N,this.spanHours=c.find(".clockpicker-span-hours"),this.spanMinutes=c.find(".clockpicker-span-minutes"),this.spanAmPm=c.find(".clockpicker-span-am-pm"),this.amOrPm="PM",u.twelvehour){{var D=['<div class="clockpicker-am-pm-block">','<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">',"AM</button>",'<button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">',"PM</button>","</div>"].join("");o(D)}o('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM</button>').on("click",function(){_.amOrPm="AM",o(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),o('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM</button>').on("click",function(){_.amOrPm="PM",o(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock)}u.autoclose||o('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+u.donetext+"</button>").click(o.proxy(this.done,this)).appendTo(c),"top"!==u.placement&&"bottom"!==u.placement||"top"!==u.align&&"bottom"!==u.align||(u.align="left"),"left"!==u.placement&&"right"!==u.placement||"left"!==u.align&&"right"!==u.align||(u.align="top"),c.addClass(u.placement),c.addClass("clockpicker-align-"+u.align),this.spanHours.click(o.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(o.proxy(this.toggleView,this,"minutes")),L.on("focus.clockpicker click.clockpicker",o.proxy(this.show,this)),O.on("click.clockpicker",o.proxy(this.toggle,this));var P,H,B,j,F=o('<div class="clockpicker-tick"></div>');if(u.twelvehour)for(P=1;13>P;P+=1)H=F.clone(),B=P/6*Math.PI,j=b,H.css("font-size","120%"),H.css({left:y+Math.sin(B)*j-E,top:y-Math.cos(B)*j-E}),H.html(0===P?"00":P),m.append(H),H.on(p,f);else for(P=0;24>P;P+=1){H=F.clone(),B=P/6*Math.PI;var I=P>0&&13>P;j=I?w:b,H.css({left:y+Math.sin(B)*j-E,top:y-Math.cos(B)*j-E}),I&&H.css("font-size","120%"),H.html(0===P?"00":P),m.append(H),H.on(p,f)}for(P=0;60>P;P+=5)H=F.clone(),B=P/30*Math.PI,H.css({left:y+Math.sin(B)*b-E,top:y-Math.cos(B)*b-E}),H.css("font-size","120%"),H.html(t(P)),g.append(H),H.on(p,f);if(h.on(p,function(e){0===o(e.target).closest(".clockpicker-tick").length&&f(e,!0)}),l){var q=c.find(".clockpicker-canvas"),R=e("svg");R.setAttribute("class","clockpicker-svg"),R.setAttribute("width",S),R.setAttribute("height",S);var U=e("g");U.setAttribute("transform","translate("+y+","+y+")");var z=e("circle");z.setAttribute("class","clockpicker-canvas-bearing"),z.setAttribute("cx",0),z.setAttribute("cy",0),z.setAttribute("r",2);var W=e("line");W.setAttribute("x1",0),W.setAttribute("y1",0);var X=e("circle");X.setAttribute("class","clockpicker-canvas-bg"),X.setAttribute("r",E);var $=e("circle");$.setAttribute("class","clockpicker-canvas-fg"),$.setAttribute("r",3.5),U.appendChild(W),U.appendChild(X),U.appendChild($),U.appendChild(z),R.appendChild(U),q.append(R),this.hand=W,this.bg=X,this.fg=$,this.bearing=z,this.g=U,this.canvas=q}i(this.options.init)}function i(e){e&&"function"==typeof e&&e()}var s,o=window.jQuery,u=o(window),a=o(document),f="http://www.w3.org/2000/svg",l="SVGAngle"in window&&function(){var e,t=document.createElement("div");return t.innerHTML="<svg/>",e=(t.firstChild&&t.firstChild.namespaceURI)==f,t.innerHTML="",e}(),c=function(){var e=document.createElement("div").style;return"transition"in e||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e}(),h="ontouchstart"in window,p="mousedown"+(h?" touchstart":""),d="mousemove.clockpicker"+(h?" touchmove.clockpicker":""),v="mouseup.clockpicker"+(h?" touchend.clockpicker":""),m=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,g=0,y=100,b=80,w=54,E=13,S=2*y,x=c?350:1,T=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>",'<span class="clockpicker-am-pm-block">',"</span>","</div>","</div>"].join("");r.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0},r.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},r.prototype.locate=function(){var e=this.element,t=this.popover,n=e.offset(),r=e.outerWidth(),i=e.outerHeight(),s=this.options.placement,o=this.options.align,u={};switch(t.show(),s){case"bottom":u.top=n.top+i;break;case"right":u.left=n.left+r;break;case"top":u.top=n.top-t.outerHeight();break;case"left":u.left=n.left-t.outerWidth()}switch(o){case"left":u.left=n.left;break;case"right":u.left=n.left+r-t.outerWidth();break;case"top":u.top=n.top;break;case"bottom":u.top=n.top+i-t.outerHeight()}t.css(u)},r.prototype.show=function(){if(!this.isShown){i(this.options.beforeShow);var e=this;this.isAppended||(s=o(document.body).append(this.popover),u.on("resize.clockpicker"+this.id,function(){e.isShown&&e.locate()}),this.isAppended=!0);var n=((this.input.prop("value")||this.options["default"]||"")+"").split(":");if("now"===n[0]){var r=new Date(+(new Date)+this.options.fromnow);n=[r.getHours(),r.getMinutes()]}this.hours=+n[0]||0,this.minutes=+n[1]||0,this.spanHours.html(t(this.hours)),this.spanMinutes.html(t(this.minutes)),this.toggleView("hours"),this.locate(),this.isShown=!0,a.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(t){var n=o(t.target);0===n.closest(e.popover).length&&0===n.closest(e.addon).length&&0===n.closest(e.input).length&&e.hide()}),a.on("keyup.clockpicker."+this.id,function(t){27===t.keyCode&&e.hide()}),i(this.options.afterShow)}},r.prototype.hide=function(){i(this.options.beforeHide),this.isShown=!1,a.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),a.off("keyup.clockpicker."+this.id),this.popover.hide(),i(this.options.afterHide)},r.prototype.toggleView=function(e,t){var n=!1;"minutes"===e&&"visible"===o(this.hoursView).css("visibility")&&(i(this.options.beforeHourSelect),n=!0);var r="hours"===e,s=r?this.hoursView:this.minutesView,u=r?this.minutesView:this.hoursView;this.currentView=e,this.spanHours.toggleClass("text-primary",r),this.spanMinutes.toggleClass("text-primary",!r),u.addClass("clockpicker-dial-out"),s.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(t),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){u.css("visibility","hidden")},x),n&&i(this.options.afterHourSelect)},r.prototype.resetClock=function(e){var t=this.currentView,n=this[t],r="hours"===t,i=Math.PI/(r?6:30),s=n*i,o=r&&n>0&&13>n?w:b,u=Math.sin(s)*o,a=-Math.cos(s)*o,f=this;l&&e?(f.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){f.canvas.removeClass("clockpicker-canvas-out"),f.setHand(u,a)},e)):this.setHand(u,a)},r.prototype.setHand=function(e,n,r,i){var s,u=Math.atan2(e,-n),a="hours"===this.currentView,f=Math.PI/(a||r?6:30),c=Math.sqrt(e*e+n*n),h=this.options,p=a&&(b+w)/2>c,d=p?w:b;if(h.twelvehour&&(d=b),0>u&&(u=2*Math.PI+u),s=Math.round(u/f),u=s*f,h.twelvehour?a?0===s&&(s=12):(r&&(s*=5),60===s&&(s=0)):a?(12===s&&(s=0),s=p?0===s?12:s:0===s?0:s+12):(r&&(s*=5),60===s&&(s=0)),this[this.currentView]!==s&&m&&this.options.vibrate&&(this.vibrateTimer||(navigator[m](10),this.vibrateTimer=setTimeout(o.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=s,this[a?"spanHours":"spanMinutes"].html(t(s)),!l)return void this[a?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var e=o(this);e.toggleClass("active",s===+e.html())});i||!a&&s%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var v=Math.sin(u)*d,g=-Math.cos(u)*d;this.hand.setAttribute("x2",v),this.hand.setAttribute("y2",g),this.bg.setAttribute("cx",v),this.bg.setAttribute("cy",g),this.fg.setAttribute("cx",v),this.fg.setAttribute("cy",g)},r.prototype.done=function(){i(this.options.beforeDone),this.hide();var e=this.input.prop("value"),n=t(this.hours)+":"+t(this.minutes);this.options.twelvehour&&(n+=this.amOrPm),this.input.prop("value",n),n!==e&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur"),i(this.options.afterDone)},r.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(u.off("resize.clockpicker"+this.id),this.popover.remove())},o.fn.clockpicker=function(e){var t=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=o(this),i=n.data("clockpicker");if(i)"function"==typeof i[e]&&i[e].apply(i,t);else{var s=o.extend({},r.DEFAULTS,n.data(),"object"==typeof e&&e);n.data("clockpicker",new r(n,s))}})}}()