function Pair(e,t){this.x=e;this.y=t}function applyRegression(e,t,n){for(var r=0;r<e.dataset.length;r++){var i=[];for(var s=1;s<e.dataset[r].data.length-n;s++){i[i.length]=new Pair(s,e.dataset[r].data[s].value)}var o=matf.process_data(i,t)[0];for(var s=e.dataset[r].data.length-n;s<e.dataset[r].data.length;s++)e.dataset[r].data[s].value=matf.regress(s,o)}return e}var gj=gj||{};gj.divide=function(e,t,n,r){for(var i=n+1;i<r;i++){e[t][i]/=e[t][n]}e[t][n]=1};gj.eliminate=function(e,t,n,r,i){for(var s=0;s<r;s++){if(s!=t&&e[s][n]!=0){for(var o=n+1;o<i;o++){e[s][o]-=e[s][n]*e[t][o]}e[s][n]=0}}};gj.echelonize=function(e){var t=e.length;var n=e[0].length;var r=0;var i=0;var s;var o;while(r<t&&i<n){s=r;while(s<t&&e[s][i]==0){s++}if(s<t){if(s!=r){o=e[r];e[r]=e[s];e[s]=o}if(e[r][i]!=1){gj.divide(e,r,i,n)}gj.eliminate(e,r,i,t,n);r++}i++}};Pair.prototype.toString=function(){return x+","+y};var matf=matf||{};matf.number_format=function(e,t,n){s=e.toExponential(t);while(s.length<n){s=" "+s}return s};matf.regress=function(e,t){var n=0;var r=0;for(var i=0;i<t.length;i++){term=t[i];n+=term*Math.pow(e,r);r++}return n};matf.corr_coeff=function(e,t){var n=0;var r=e.length;var i=0;var s=0,o=0,u=0,a=0;var f,l;for(var c=0;c<e.length;c++){pr=e[c];var f=matf.regress(pr.x,t);var l=pr.y;i+=f;o+=l;a+=f*l;s+=f*f;u+=l*l}var h=Math.sqrt((s-i*i/r)*(u-o*o/r));if(h!=0){n=Math.pow((a-i*o/r)/h,2)}return n};matf.std_error=function(e,t){var n=0;var r=e.length;if(r>2){var i=0;for(var s=0;s<e.length;s++){pr=e[s];i+=Math.pow(matf.regress(pr.x,t)-pr.y,2)}n=Math.sqrt(i/(r-2))}return n};matf.compute_coefficients=function(e,t){t+=1;var n=e.length;var r,i;var s=2*t-1;m=Array();for(var o=0;o<t;o++){mm=Array();for(var u=0;u<=t;u++){mm[u]=0}m[o]=mm}mpc=Array();for(var o=0;o<s;o++){mpc[o]=0}mpc[0]=n;for(var o=0;o<e.length;o++){pr=e[o];for(r=1;r<s;r++){mpc[r]+=Math.pow(pr.x,r)}m[0][t]+=pr.y;for(r=1;r<t;r++){m[r][t]+=Math.pow(pr.x,r)*pr.y}}for(r=0;r<t;r++){for(i=0;i<t;i++){m[r][i]=mpc[r+i]}}gj.echelonize(m);terms=Array();for(var o=0;o<m.length;o++){mc=m[o];terms[o]=mc[t]}return terms};matf.test=function(){var e=[-1,0,1,2,3,5,7,9];var t=[-1,3,2.5,5,4,2,5,4];data=Array();for(var n=0;n<e.length;n++){data[n]=new Pair(e[n],t[n])}terms=compute_coefficients(data,6);var r=16;var i=24;for(var n=0;n<terms.length;n++){print(number_format(terms[n],r,i)+" * x^"+n)}cc=corr_coeff(data,terms);print("cc = "+number_format(cc,r,i));se=std_error(data,terms);print("se = "+number_format(se,r,i))};matf.process_data=function(e,t){var n=matf.compute_coefficients(e,t);var r=matf.corr_coeff(e,n);var i=matf.std_error(e,n);return[n,r,i]}